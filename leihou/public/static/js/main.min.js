(function(d){var g={isValid:false,answear_a_ok:false,answear_b_ok:false,modal_bug_text:"",hongbao_code:"",question_code:"",answear_a:"",answear_b:"",description_name:"",description_right:"",description_wrong:""};var b=(window.location.hash).replace(/#/g,"");c("modal-bug-text",200);c("hongbao-code",10);c("question-code",150);c("answear-a",20);c("answear-b",20);c("description-name",20);c("description-right",20);c("description-wrong",20);d(".modal-trigger").leanModal({dismissible:true,opacity:0.5,in_duration:50,out_duration:100,ready:function(){},complete:function(){}});d("#modal-bug-submit").click(function(k){if(!i("modal-bug-text",200)){return}d.ajax({url:"/hongbao/report",method:"POST",data:{data:d("#modal-bug-text").val()},success:function(){d("#modal-bug").closeModal()},error:function(l){alert("呃……服务器被我关了")}})});d("#send-hongbao").click(function(){if(!e()){return}g["time"]=new Date().getTime();d.ajax({url:"/hongbao/set",method:"POST",data:g,success:function(k){window.location="/bao/"+k.location+".html#"+k.hash},error:function(k){alert("呃……服务器被我关了")}})});d("#show-me-ur-money-btn").click(function(){window.location.hash="#"+b;var k=d("#show-me-ur-money-btn").hasClass("locked")||(f("miss")==(window.location.hash).replace(/#/g,""));if(k){d("#show-me-ur-money-btn").html('<i class="icon-lock yellow darken-3"></i>');return}else{d("#money-trick").openModal()}});d("#hongbao-check-btn").click(function(l){clientData={clientHash:b};var k=d('input[type="radio"][name="answear"]:checked').val();if(k){clientData["clientRet"]=k}else{alert("请先点击，选择其中一个答案");return}d.ajax({url:"/hongbao/check",method:"POST",data:clientData,success:function(m){if(m.result=="ok"&&m.key==k){var n=d("<span class='green'>"+m.description_right+"</span>");Materialize.toast(n,3000);if(0>=d("#boxOpen").length){d("#hongbao-card-content").prepend('<br><p id="boxOpen">红包口令: '+m.box+"</p>");d("#show-me-ur-money-btn").html('<i class="icon-lock-open yellow darken-3"></i>')}}else{if(m.result=="ok"&&m.key!=k){var n=d("<span class='green'>"+m.description_wrong+"</span>");Materialize.toast(n,3000);j("miss",clientData.clientHash,3);d("#show-me-ur-money-btn").addClass("locked");d("#show-me-ur-money-btn").html('<i class="icon-lock yellow darken-3"></i>')}else{var n=d("<span class='green'>"+"呃……红包不是发你的？"+"</span>");Materialize.toast(n,3000)}}},error:function(m){alert("呃……服务器被我关了")}});d("#money-trick").closeModal()});d(".ripple-btn").click(a);function a(p){var o=p.target;if(o.tagName.toLowerCase()!=="div"){return}var l=o.getBoundingClientRect();var k=o.querySelector(".ripple");if(!k){k=document.createElement("span");k.className="ripple";k.style.height=k.style.width=Math.max(l.width,l.height)+"px";o.appendChild(k)}k.classList.remove("show");var n=p.pageY-l.top-k.offsetHeight/2-document.body.scrollTop;var m=p.pageX-l.left-k.offsetWidth/2-document.body.scrollLeft;k.style.top=n+"px";k.style.left=m+"px";k.classList.add("show");return false}function i(l,k){var m=d("#"+l).val();if(m.length<=k){return true}else{return false}}function c(n,k){var m=d("#"+n+"-warning");var l=d("#"+n);l.keyup(function(){var o=l.val().length;if(o>k){m.css("color","red");g[isValid]=false}else{g[n.replace(/-/g,"_")]=l.val()}m.text("已输入"+o+"/"+k)})}function e(){g["answear_a_ok"]=(true==d("#answear-a-right").prop("checked"))?true:false;g["answear_b_ok"]=(true==d("#answear-b-right").prop("checked"))?true:false;if(g["answear_a_ok"]||g["answear_b_ok"]){}else{g["answear_a_ok"]=(Math.random()>0.5);g["answear_b_ok"]=!g["answear_a_ok"]}for(var k in g){if("isValid"!=k&&"modal_bug_text"!=k&&g[k].length==0){window.location.hash="#"+k.replace(/_/g,"-");return false}}return true}function j(m,n,o){if(o){var l=new Date();l.setTime(l.getTime()+(o*24*60*60*1000));var k="; expires="+l.toGMTString()}else{var k=""}document.cookie=m+"="+n+k+"; path=/"}function f(l){var n=l+"=";var k=document.cookie.split(";");for(var m=0;m<k.length;m++){var o=k[m];while(o.charAt(0)==" "){o=o.substring(1,o.length)}if(o.indexOf(n)==0){return o.substring(n.length,o.length)}}return null}function h(k){createCookie(k,"",-1)}})(jQuery);